#include "pic.h"

FILTER Filters[] =
{
  {
    "Blur",
    {
      {1, 1, 1},
      {1, 1, 1},
      {1, 1, 1}
    }, 9, 0
  },
  {
    "Small Blur",
    {
      {0, 1, 0},
      {1, 1, 1},
      {0, 1, 0}
    }, 5, 0
  },
  {
    "Gauss Blur",
    {
      {1, 2, 1},
      {2, 4, 2},
      {1, 2, 1}
    }, 16, 0
  },
  {
    "Hi-pass big",
    {
      {-1, -1, -1},
      {-1, 9, -1},
      {-1, -1, -1}
    }, 1, 0
  },
  {
    "Hi-pass small",
    {
      {0, -1, 0},
      {-1, 5, -1},
      {0, -1, 0}
    }, 1, 0
  },
  {
    "Laplass",
    {
      {-1, -1, -1},
      {-1, 8, -1},
      {-1, -1, -1}
    }, 1, 128
  },
  {
    "Laplass small",
    {
      {0, -1, 0},
      {-1, 4, -1},
      {0, -1, 0}
    }, 1, 128
  },
  {
    "Emb small NW",
    {
      {-1, 0, 0},
      {0, 1, 0},
      {0, 0, 0}
    }, 1, 128
  },
  {
    "Emb small N",
    {
      {0, -1, 0},
      {0, 1, 0},
      {0, 0, 0}
    }, 1, 128
  },
  {
    "Emb small NE",
    {
      {0, 0, -1},
      {0, 1, 0},
      {0, 0, 0}
    }, 1, 128
  },
  {
    "Emb small E",
    {
      {0, 0, 0},
      {0, 1, -1},
      {0, 0, 0}
    }, 1, 128
  },
  {
    "Emb small SE",
    {
      {0, 0, 0},
      {0, 1, 0},
      {0, 0, -1}
    }, 1, 128
  },
  {
    "Emb small S",
    {
      {0, 0, 0},
      {0, 1, 0},
      {0, -1, 0}
    }, 1, 128
  },
  {
    "Emb small SW",
    {
      {0, 0, 0},
      {0, 1, 0},
      {-1, 0, 0}
    }, 1, 128
  },
  {
    "Emb small W",
    {
      {0, 0, 0},
      {-1, 1, 0},
      {0, 0, 0}
    }, 1, 128
  },
  {
    "Emb big NW",
    {
      {-1, -1, -1},
      {-1, 2, 1},
      {-1, 1, 1}
    }, 1, 128
  },
  {
    "Emb big N",
    {
      {-1, -1, -1},
      {-1, 2, -1},
      {1, 1, 1}
    }, 1, 128
  },
  {
    "Emb big NE",
    {
      {-1, -1, -1},
      {1, 2, -1},
      {1, 1, -1}
    }, 1, 128
  },
  {
    "Emb big E",
    {
      {1, -1, -1},
      {1, 2, -1},
      {1, -1, -1}
    }, 1, 128
  },
  {
    "Emb big SE",
    {
      {1, 1, -1},
      {1, 2, -1},
      {-1, -1, -1}
    }, 1, 128
  },
  {
    "Emb big S",
    {
      {1, 1, 1},
      {-1, 2, -1},
      {-1, -1, -1}
    }, 1, 128
  },
  {
    "Emb big SW",
    {
      {-1, 1, 1},
      {-1, 2, 1},
      {-1, -1, -1}
    }, 1, 128
  },
  {
    "Emb big W",
    {
      {-1, -1, 1},
      {-1, 2, 1},
      {-1, -1, 1}
    }, 1, 128
  }
};

#define N_FILTERS (sizeof(Filters) / sizeof(Filters[0]))

int NumOfFilters = N_FILTERS;

void PicFilter( PIC *PDest, PIC *PSrc, FILTER *F )
{
  int x, y, c, i, j;
  double sum;

  for (x = 0; x < PSrc->W; x++)
    for (y = 0; y < PSrc->H; y++)
      for (c = 0; c < 3; c++)
      {
        sum = 0;
        for (i = 0; i < 3; i++)
          for (j = 0; j < 3; j++)
            sum += F->A[i][j] * PicGet(PSrc, x + i - 1, y + j - 1, c);
        PicSet(PDest, x, y, c, Clamp(sum / F->Frac + F->Bias, 0, 255));
      }
}
